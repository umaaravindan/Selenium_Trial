pipeline {
    agent any

    environment {
        DOCKER_IMAGE = 'chatlearning123/getting-started/umadocker:latest'
        DOCKER_CREDENTIALS_ID = 'GIT_ID'
    }

    stages {
        stage('Checkout') {
            steps {
                echo 'Checking out the repository...'
                git 'https://github.com/umaaravindan/Selenium_Trial.git'
                echo 'Repository checked out.'
            }
        }

        stage('Build Docker Image') {
            steps {
                script {
                    echo 'Building Docker image...'
                    try {
                        docker.withRegistry('https://index.docker.io/v1/', DOCKER_CREDENTIALS_ID) {
                            def customImage = docker.build(DOCKER_IMAGE)
                            echo 'Docker image built successfully.'
                            echo 'Pushing Docker image...'
                            customImage.push()
                            echo 'Docker image pushed successfully.'
                        }
                    } catch (Exception e) {
                        echo 'Failed to build or push Docker image: ' + e.toString()
                        error 'Stopping pipeline due to failure.'
                    }
                }
            }
        }
    }

    post {
        success {
            echo 'Pipeline completed successfully.'
        }
        failure {
            echo 'Pipeline failed.'
        }
    }
}
